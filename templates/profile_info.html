{% extends 'profile.html' %}

{% block profile_content %}
<div class="profile-main-section__wrapper">
    <div class="content-label">Профиль</div>
    <form id="profileForm" method="post">
        <div class="profile-info-group">
            <span class="profile-info-group__text">Контактные данные</span>
            <div class="input-group mb-3">
                <span class="input-group-text">Ваш телефон</span>
                {{ form.phone(class='form-control', placeholder='+7') }}
            </div>
            <div class="input-group mb-3">
                <span class="input-group-text" id="input-email-label">Ваш E-mail</span>
                {{ form.email(class='form-control', placeholder='example@mail.ru') }}

            </div>
        </div>
        <div class="profile-info-group">
            <span class="profile-info-group__text">Личные данные</span>
            <div class="input-group mb-3">
                <span class="input-group-text">Фамилия</span>
                {{ form.surname(class='form-control', placeholder='Фамилия') }}
            </div>
            <div class="input-group mb-3">
                <span class="input-group-text">Имя</span>
                {{ form.name(class='form-control', placeholder='Имя') }}
            </div>
            <div class="input-group mb-3">
                <span class="input-group-text">Отчество</span>
                {{ form.patronymic(class='form-control', placeholder='Отчество') }}
            </div>
        </div>
        <div class="profile-info-group">
            <span class="profile-info-group__text">Дата рождения</span>
            {{ form.birth_date(class='form-control input-group') }}
        </div>
        <div class="profile-info-group">
            <span class="profile-info-group__text">Ваш пол</span>
            <div class="input-group"
                 style="display: grid; grid-template-rows: 100%; grid-template-columns: 100px auto; column-gap: 20px">
                {% for subfield in form.sex %}
                <div class="radio-group">
                    <span class="radio-checkbox">{{ subfield }}</span>
                    <span>{{ subfield.label }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="submit__wrapper">
            <input class="btn btn-secondary save-btn input-group" type="submit" value="Сохранить"
                   name="save_submit">
            <a href="#" class="btn btn-danger" data-easy-toggle="#modalWin" data-easy-class="show">Удалить
                профиль</a>
            <span id="save-status-text">{{ status_text }}</span>
            {% include 'form_confirmation.html' %}
        </div>
    </form>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
    const user_id = {{user_id|tojson}};

    loadApiUser(user_id).then(data => {
        const user = data['user']

        const fillIfExists = (id, value) => {
            const el = document.getElementById(id);
            if (el && value !== undefined) el.value = value;
        };

        fillIfExists("phone", user.phone);
        fillIfExists("email", user.email);
        fillIfExists("surname", user.surname);
        fillIfExists("name", user.name);
        fillIfExists("patronymic", user.patronymic);
        fillIfExists("birth_date", user.birth_date);

        // Пол: выбираем radio с нужным value
        if (user.sex) {
            const sexRadio = document.querySelector(`input[name="sex"][value="${user.sex}"]`);
            if (sexRadio) sexRadio.checked = true;
        }
    });
    });
</script>
{% endblock %}